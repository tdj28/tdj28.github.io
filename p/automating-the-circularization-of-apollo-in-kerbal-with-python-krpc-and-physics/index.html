<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Using the krpc library, we can automate a rocket simulator, turnking Kerbal space program into a more powerful educational tool. In this post, we automate the launching and circularization of the Kerbal equivalent of the Apollo rocket."><title>Automating the circularization of Apollo in Kerbal with python, KRPC, and Physics</title>
<link rel=canonical href=https://tdj28.github.io/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/><link rel=stylesheet href=/scss/style.min.a8973e64013f393b33658832ff110095f30eb03e142d9ad3540bb8edbbed8261.css><meta property='og:title' content="Automating the circularization of Apollo in Kerbal with python, KRPC, and Physics"><meta property='og:description' content="Using the krpc library, we can automate a rocket simulator, turnking Kerbal space program into a more powerful educational tool. In this post, we automate the launching and circularization of the Kerbal equivalent of the Apollo rocket."><meta property='og:url' content='https://tdj28.github.io/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/'><meta property='og:site_name' content><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='kerbal'><meta property='article:tag' content='python'><meta property='article:tag' content='physics'><meta property='article:tag' content='space'><meta property='article:published_time' content='2022-07-23T15:21:05-07:00'><meta property='article:modified_time' content='2022-07-23T15:21:05-07:00'><meta name=twitter:title content="Automating the circularization of Apollo in Kerbal with python, KRPC, and Physics"><meta name=twitter:description content="Using the krpc library, we can automate a rocket simulator, turnking Kerbal space program into a more powerful educational tool. In this post, we automate the launching and circularization of the Kerbal equivalent of the Apollo rocket."><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky compact"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu15237315471355360968.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>TJ</span></figure><div class=site-meta><h1 class=site-name><a href=/></a></h1><h2 class=site-description></h2></div></header><ol class=menu-social><li><a href=https://github.com/tdj28 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/tdj11100 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span></span></li></ol><ol class=menu id=main-menu></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon id=toc-toggle><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-notes"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 3m0 2a2 2 0 012-2h10a2 2 0 012 2v14a2 2 0 01-2 2H7a2 2 0 01-2-2z"/><path d="M9 7h6"/><path d="M9 11h6"/><path d="M9 15h4"/></svg></div><h2 class="widget-title section-title"></h2><div class=widget--toc id=toc-content><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a><ol><li><a href=#installation>Installation</a><ol><li><a href=#get-ksp>Get KSP</a></li><li><a href=#install-the-krpc-mod>Install the KRPC mod</a></li><li><a href=#prepping-the-jupyter-workspace>Prepping the jupyter workspace</a></li></ol></li></ol></li><li><a href=#going-to-the-mun>Going to the Mun</a><ol><li><a href=#connecting-to-ksp>Connecting to KSP</a></li><li><a href=#loading-the-apollo-rocket>Loading the Apollo rocket</a></li><li><a href=#gravity-turn-into-orbit>Gravity Turn into Orbit</a></li></ol></li><li><a href=#circularizing-the-orbit>Circularizing the orbit</a><ol><li><a href=#finding-an-equation-for-the-circularization-of-an-orbit>Finding an equation for the circularization of an orbit</a><ol><li><a href=#relating-this-to-elipses-the-apoapsis-and-periapsis>Relating this to elipses, the apoapsis and periapsis</a></li></ol></li></ol></li></ol></nav></div></section><script>document.getElementById("toc-toggle").addEventListener("click",function(){var e=document.getElementById("toc-content");e.style.display==="none"?e.style.display="block":e.style.display="none"})</script></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/deep-dive/>Deep-Dive
</a><a href=/categories/physics/>Physics</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/>Automating the circularization of Apollo in Kerbal with python, KRPC, and Physics</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 23, 2022</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>9 minute read</time></div></footer></div></header><section class=article-content><p><img src=/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-02bb3.png width=826 height=400 srcset="/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-02bb3_hu17640899176375355365.png 480w, /p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-02bb3_hu17225187193578015173.png 1024w" loading=lazy alt="A picture of the kerbal apollo rocket" class=gallery-image data-flex-grow=206 data-flex-basis=495px></p><p><a class=link href=krpc_sanbox-into-orbit.ipynb>Download</a> the corresponding notebook.</p><h2 id=introduction>Introduction</h2><p>Kerbal Space Program (KSP) (1.0) is a semi-physics-realistic space exploration simulation. While it is not realistic enough to plan actual space missions, it is a fun educational tool that can get us started. With the kRPC mod (remote procedure call, which enables programatic interaction with KSP&rsquo;s API), the educational potential is expanded into the world of programming. In this notebook, we will automate taking the Kerbins to the moon and back using Python, Physics, and KSP with the kRPC mod.</p><h3 id=installation>Installation</h3><h4 id=get-ksp>Get KSP</h4><ul><li>Purchase and install the Kerbal Space Program (v 1.0) <a class=link href=https://www.kerbalspaceprogram.com/ target=_blank rel=noopener>here</a>.</li><li>You&rsquo;ll also need the <a class=link href=https://www.kerbalspaceprogram.com/games-kerbal-space-program-making-history-expansion target=_blank rel=noopener>&ldquo;Making History&rdquo; expansion</a> which has the Apollo rocket equivalent, unless you prefer to save some money and build an equivalent rocket yourself or find the ship file online. Note that this code is tested and verified to work with the Acopollo rocket found in this expansion, so you may have to make adjustments to get alternative rockets to work.</li></ul><h4 id=install-the-krpc-mod>Install the KRPC mod</h4><p>Follow <a class=link href=https://krpc.github.io/krpc/getting-started.html target=_blank rel=noopener>this guide</a> to install the kRPC mod. More or less, you&rsquo;ll grab the kRPC folder and put it in the <code>GameData</code> folder wherever Kerbal is installed on your workstation.</p><p><img src=/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-439c4.png width=735 height=323 srcset="/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-439c4_hu2563673172473898305.png 480w, /p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-439c4_hu12312013963594548964.png 1024w" loading=lazy alt="An image that shows the folder structure of KSP on Windows" class=gallery-image data-flex-grow=227 data-flex-basis=546px></p><h4 id=prepping-the-jupyter-workspace>Prepping the jupyter workspace</h4><p>If you are using Windows, <a class=link href=https://docs.anaconda.com/anaconda/install/windows/ target=_blank rel=noopener>installing anaconda</a> may be your quickest route, and then set up a kerbal environment by opensing a terminal and running:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>conda create --name kerbal
</span></span></code></pre></td></tr></table></div></div><p>You&rsquo;ll only need to create the envrionment once. Next activate it:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>conda activate kerbal
</span></span></code></pre></td></tr></table></div></div><p>If you are on MacOS or Linux, you can use virtualenv instead (although conda can work too).</p><p>and then install the following packages:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>pip</span> <span class=n>install</span> <span class=n>setuptools</span><span class=o>==</span><span class=mf>57.5</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>pip</span> <span class=n>install</span> <span class=n>protobuf</span><span class=o>~=</span><span class=mf>3.19</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>pip</span> <span class=n>install</span> <span class=n>krpc</span>
</span></span><span class=line><span class=cl><span class=n>pip</span> <span class=n>install</span> <span class=n>jupyter</span>
</span></span><span class=line><span class=cl><span class=n>pip</span> <span class=n>install</span> <span class=n>ipykernel</span>
</span></span></code></pre></td></tr></table></div></div><p>Or preferably, use a requirements file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>setuptools</span><span class=o>==</span><span class=mf>57.5</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>protobuf</span><span class=o>~=</span><span class=mf>3.19</span><span class=o>.</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>krpc</span>
</span></span><span class=line><span class=cl><span class=n>jupyter</span>
</span></span><span class=line><span class=cl><span class=n>ipykernel</span>
</span></span></code></pre></td></tr></table></div></div><p>If you are using Python >= 3.8, you&rsquo;ll have to do a little hack. Open the file in your virtual environment files with an editor and make the following change.</p><ul><li><p>FILE: Should be in your virtual environment with something along the lines of <code>venv/lib/python3.10/site-packages/krpc/types.py</code> on line 222 and 227.</p></li><li><p>Replace:</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>collections</span><span class=o>.</span><span class=n>Iterable</span>
</span></span></code></pre></td></tr></table></div></div><p>with</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>collections</span><span class=o>.</span><span class=n>abc</span><span class=o>.</span><span class=n>Iterable</span>
</span></span></code></pre></td></tr></table></div></div><p>Next, create the kernel that we&rsquo;ll be using for this notebook:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>python -m ipykernel install --user --name kerbal --display-name &#34;Python (kerbal)&#34;
</span></span></code></pre></td></tr></table></div></div><p>and then to launch jupyter:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>jupyter notebook
</span></span></code></pre></td></tr></table></div></div><h2 id=going-to-the-mun>Going to the Mun</h2><h3 id=connecting-to-ksp>Connecting to KSP</h3><p>In our first code blocks, we will be importing the libraries we need to get our astronauts to the Mun via Python. We will then connect to KSP vis the krpc plugin (assumes you have KSP up and running and the plugin working).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>krpc</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>math</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>IPython.display</span> <span class=kn>import</span> <span class=n>clear_output</span><span class=p>,</span> <span class=n>display</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>conn</span> <span class=o>=</span> <span class=n>krpc</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=loading-the-apollo-rocket>Loading the Apollo rocket</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>space_center</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s2>&#34;apollo001&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>vessel</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>space_center</span><span class=o>.</span><span class=n>active_vessel</span>
</span></span><span class=line><span class=cl><span class=c1># Set up streams for telemetry</span>
</span></span><span class=line><span class=cl><span class=n>ut</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>add_stream</span><span class=p>(</span><span class=nb>getattr</span><span class=p>,</span> <span class=n>conn</span><span class=o>.</span><span class=n>space_center</span><span class=p>,</span> <span class=s1>&#39;ut&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>altitude</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>add_stream</span><span class=p>(</span><span class=nb>getattr</span><span class=p>,</span> <span class=n>vessel</span><span class=o>.</span><span class=n>flight</span><span class=p>(),</span> <span class=s1>&#39;mean_altitude&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>apoapsis</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>add_stream</span><span class=p>(</span><span class=nb>getattr</span><span class=p>,</span> <span class=n>vessel</span><span class=o>.</span><span class=n>orbit</span><span class=p>,</span> <span class=s1>&#39;apoapsis_altitude&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>stage_2_resources</span> <span class=o>=</span> <span class=n>vessel</span><span class=o>.</span><span class=n>resources_in_decouple_stage</span><span class=p>(</span><span class=n>stage</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>cumulative</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>obt_frame</span> <span class=o>=</span> <span class=n>vessel</span><span class=o>.</span><span class=n>orbit</span><span class=o>.</span><span class=n>body</span><span class=o>.</span><span class=n>non_rotating_reference_frame</span>
</span></span><span class=line><span class=cl><span class=n>mun_orbit</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>space_center</span><span class=o>.</span><span class=n>bodies</span><span class=p>[</span><span class=s2>&#34;Mun&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>position</span><span class=p>(</span><span class=n>obt_frame</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=gravity-turn-into-orbit>Gravity Turn into Orbit</h3><p>In this next section, we are calculating the gravity turn angle. The sample provided by the KRPC samples uses a simple fraction to define the trun angle in degrees:
\[ \alpha = 90(\frac{a - s}{ e - s}) \]
where \(a\) is the current altitude, \(s\) is the altitude in which we want to start slowly turning the rocket horizontally, and \(e\) is the ending altitude where we want to have completed our turn upon reaching. This could be defined by a simple function</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_gravity_turn_angle</span><span class=p>(</span><span class=n>alt</span><span class=p>,</span> <span class=n>start_alt</span><span class=p>,</span> <span class=n>end_alt</span><span class=p>,</span> <span class=n>turn_angle</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>new_turn_angle</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>alt</span> <span class=o>&gt;</span> <span class=n>start_alt</span> <span class=ow>and</span> <span class=n>alt</span> <span class=o>&lt;</span> <span class=n>end_alt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>frac</span> <span class=o>=</span> <span class=p>(</span><span class=n>alt</span> <span class=o>-</span> <span class=n>start_alt</span><span class=p>)</span><span class=o>/</span><span class=p>(</span><span class=n>end_alt</span> <span class=o>-</span> <span class=n>start_alt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>new_turn_angle</span> <span class=o>=</span> <span class=n>frac</span> <span class=o>*</span> <span class=mf>90.0</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>abs</span><span class=p>(</span><span class=n>new_turn_angle</span> <span class=o>-</span> <span class=n>turn_angle</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>turn_angle</span> <span class=o>=</span> <span class=n>new_turn_angle</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>turn_angle</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>turn_angle</span>
</span></span></code></pre></td></tr></table></div></div><p>In a future blog post, we will improve the gravity turn by invoking Physics to get a more accurate turn rate. For now, as a proof of concept and to focus on the circularization physics, we will proceed with this rough linear gravity turn. Next, we actually launch the rocket and execute the gravity turn so that we reach a target apoapsis:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>target_pitch_and_heading</span><span class=p>(</span><span class=mi>90</span><span class=p>,</span> <span class=mi>90</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>engage</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>throttle</span> <span class=o>=</span> <span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>activate_next_stage</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>turn_angle</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>start_alt</span> <span class=o>=</span> <span class=mi>250</span>
</span></span><span class=line><span class=cl><span class=n>end_alt</span> <span class=o>=</span> <span class=mi>45000</span>
</span></span><span class=line><span class=cl><span class=n>target_alt</span> <span class=o>=</span> <span class=mi>700000</span>
</span></span><span class=line><span class=cl><span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;LiftOff&#34;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>turn_angle</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>throttle</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>clear_output</span><span class=p>(</span><span class=n>wait</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>turn_angle</span> <span class=o>=</span> <span class=n>get_gravity_turn_angle</span><span class=p>(</span><span class=n>altitude</span><span class=p>(),</span> <span class=n>start_alt</span><span class=p>,</span> <span class=n>end_alt</span><span class=p>,</span> <span class=n>turn_angle</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>turn_angle</span> <span class=o>!=</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>apoapsis</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>target_alt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>target_pitch_and_heading</span><span class=p>(</span><span class=mi>90</span><span class=o>-</span><span class=n>turn_angle</span><span class=p>,</span> <span class=mi>90</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;GravityTurn&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>apoapsis</span><span class=p>()</span> <span class=o>&gt;</span> <span class=n>target_alt</span><span class=o>*</span><span class=mf>0.90</span> <span class=ow>and</span> <span class=n>apoapsis</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>target_alt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;ApoapsisRefinement&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>throttle</span> <span class=o>=</span> <span class=mf>0.25</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>apoapsis</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>target_alt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>apoapsis</span><span class=p>()</span> <span class=o>&gt;=</span> <span class=n>target_alt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=s2>&#34;GoalApoapsisAchieved&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>throttle</span> <span class=o>=</span> <span class=mf>0.00</span>       
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-41f20.png width=989 height=555 srcset="/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-41f20_hu7997958309861504924.png 480w, /p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-41f20_hu15015125646027603701.png 1024w" loading=lazy alt="The rocket starts to turn, making a 30 degree angle relative to the normal" class=gallery-image data-flex-grow=178 data-flex-basis=427px></p><p>As the rocket climbs higher, it will ease into an orientation perpendicular to the radius of the Earth:</p><p><img src=/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-a87dd.png width=993 height=559 srcset="/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-a87dd_hu8397308396075874361.png 480w, /p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-a87dd_hu11992571244312514553.png 1024w" loading=lazy alt="as it nears cutoff, the rocket is nearly perpendicular to the normal" class=gallery-image data-flex-grow=177 data-flex-basis=426px></p><h2 id=circularizing-the-orbit>Circularizing the orbit</h2><p>For an idealized circular orbit above atmospheric effects, the gravitational pull of the Earth on the body provides the centripetal force, with circular orbital radius \(r\) and let</p><p>\[\mu = GM\]</p><p>where \(G\) is the universal gravitational constant and \(M\) is the mass of the large body (here, the Earth)</p><p>KRPC provides an easy way to access that value for any given celestial body:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>mu</span> <span class=o>=</span> <span class=n>vessel</span><span class=o>.</span><span class=n>orbit</span><span class=o>.</span><span class=n>body</span><span class=o>.</span><span class=n>gravitational_parameter</span>
</span></span></code></pre></td></tr></table></div></div><p>Back to Physics, we now have two equations from the basics of Newtonian physics, namely:</p><ul><li>Cetripital Force: \[ F_c = \frac{m_0 v^2}{r}\]</li><li>Gravitational Force: \[ F_g = \frac{m_0 GM}{r^2}\]</li></ul><p>Since these must balance out for an object to be in stead orbit, we can solve to find the ideal velocity \(v\) for a given orbit at radius \(r\):</p><p>\[ F_g = m_0 a = \frac{m_0 \mu}{r^2} =\frac{m_0 v^2}{r} \]</p><p>\[\implies v = \sqrt{ \frac{\mu}{r} }\]</p><p>We see here that this velocity is entirely independent of the mass of the body, hence a very heavy object and a very light object which orbit at the same radius must be traveling at the same speed, assuming of course they are out of the region where atmospheric drag plays an important role.</p><h3 id=finding-an-equation-for-the-circularization-of-an-orbit>Finding an equation for the circularization of an orbit</h3><p>That is a starting point, but we have to dive deeper to calculate the numbers needed to actually achieve an approximation of this idealized orbit.</p><p>Our next step is to invoke the <em>vis-viva equation</em> (or also called the <em>orbital-energy-invariance law</em>). We begin by noting that the <strong>specific orbital energy</strong> of an orbiting object and the body it is orbiting is defined as a sum of their mutual potential energy and their total kinetic energy:</p><p>\[ E_O = E_p + E_k\]</p><p>For scenarios such as ours, where the orbiting object is much smaller in both size and mass than the body it orbits, this energy becomes easier to calculate since we can treat the larger body as being the center of our reference frame and hence at rest. We can also neglect the potential energy experienced by the gravitational attraction of the larger body by the smaller body. In this case,</p><p>\[ E_O = \frac{m_0 v^2_0}{2} - \frac{\mu m_0}{r_0} \]</p><p>The specific total energy is given as \(E_o/m_0 = \epsilon\) and this is conserved throughout the orbit (assuming the rocket is not burning fuel in an idealized orbit). Let \(v_a\) and \(r_a\) be the velocity and radius of the orbiting body at the apoapsis, and \(v_p\) and \(r_p\) similarly at the periapsis. Then energy conservation gives us the relation,</p><p>\[ \epsilon = \frac{v_a^2}{2} - \frac{\mu}{r_a} = \frac{v_p^2}{2} - \frac{\mu}{r_p} \]</p><p>At both \(r_a\) and \(r_p\), the velocity and radius vectors are perpendicular to each other, where hence we can invoke the conservation of angular momentum to give</p><p>\[ r_p v_p = r_a v_a = Constant \]</p><p>This gives us the relation that
\[ v_p =- \frac{r_a}{r_p}v_a \]</p><p>and with some rearrangement of these equations, we get,</p><p>\[ \frac{1}{2}\left( \frac{r_p^2 -r_a^2}{r_p^2}\right) v_a^2 = \mu \left(\frac{1}{r_a} - \frac{1}{r_p}\right) \]
\[ \frac{1}{2}v_a^2 = \mu \frac{r_p}{r_a \left( r_p + r_a \right)} \]</p><h4 id=relating-this-to-elipses-the-apoapsis-and-periapsis>Relating this to elipses, the apoapsis and periapsis</h4><p>From geometry of an ellipse that relates the semimajor axis to \(r_p\) and \(r_a\), \(2a = r_p + r_a\)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span>  <span class=n>vessel</span><span class=o>.</span><span class=n>orbit</span><span class=o>.</span><span class=n>apoapsis</span>
</span></span><span class=line><span class=cl><span class=n>a1</span> <span class=o>=</span> <span class=n>vessel</span><span class=o>.</span><span class=n>orbit</span><span class=o>.</span><span class=n>semi_major_axis</span>
</span></span></code></pre></td></tr></table></div></div><p>We substitute 2a in the our prior kinetic energy equation:
\[ \frac{1}{2}v_a^2 = \mu \frac{2a -r_a}{2 r_a a} \]
\[ \frac{1}{2}v_a^2 = \mu \left(\frac{1}{r_a} - \frac{1}{2a}\right) \]</p><p>\[ v_a^2 = \mu \left( \frac{2}{r_a} - \frac{1}{a}\right) \]</p><p>In a circularized orbit, \(a = r\), and so the velocity we need to have is</p><p>\[ v_a^2 = \mu \left( \frac{2}{r_a} - \frac{1}{r_a}\right) = \mu \left( \frac{1}{r_a}\right) \]</p><p>The \(\Delta v\) we need to achieve is the difference between these two velocities,</p><p>$$ \Delta v = \sqrt{ \mu} \left( \sqrt{\left( \frac{1}{r_a}\right) } - \sqrt{\left( \frac{2}{r_a} - \frac{1}{a}\right)}\right) $$
$$ = \sqrt{\frac{\mu}{r_a}}\left( 1 - \sqrt{ \frac{2a -r_a}{a}}\right) $$</p><p>In krpc code,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>delta_v</span> <span class=o>=</span> <span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>mu</span><span class=o>/</span><span class=n>r</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>((</span><span class=mi>2</span><span class=o>*</span><span class=n>a1</span><span class=o>-</span><span class=n>r</span><span class=p>)</span><span class=o>/</span><span class=n>a1</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>With this number in hand, we can do a little more math which will be discussed in more detail later to find the burn time. This calculation is highly dependent on the engine and design of the rocket in question:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span> <span class=n>vessel</span><span class=o>.</span><span class=n>available_thrust</span>
</span></span><span class=line><span class=cl><span class=n>Isp</span> <span class=o>=</span> <span class=n>vessel</span><span class=o>.</span><span class=n>specific_impulse</span> <span class=o>*</span> <span class=mf>9.82</span>
</span></span><span class=line><span class=cl><span class=n>m0</span> <span class=o>=</span> <span class=n>vessel</span><span class=o>.</span><span class=n>mass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>m1</span> <span class=o>=</span> <span class=n>m0</span> <span class=o>/</span> <span class=n>math</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=n>delta_v</span> <span class=o>/</span> <span class=n>Isp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fr</span> <span class=o>=</span> <span class=n>f</span> <span class=o>/</span> <span class=n>Isp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>burn_time</span> <span class=o>=</span> <span class=p>(</span><span class=n>m0</span> <span class=o>-</span> <span class=n>m1</span><span class=p>)</span> <span class=o>/</span> <span class=n>fr</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>node</span> <span class=o>=</span> <span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>add_node</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>ut</span><span class=p>()</span> <span class=o>+</span> <span class=n>vessel</span><span class=o>.</span><span class=n>orbit</span><span class=o>.</span><span class=n>time_to_apoapsis</span><span class=p>,</span> <span class=n>prograde</span><span class=o>=</span><span class=n>delta_v</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># https://krpc.github.io/krpc/tutorials/launch-into-orbit.html</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Orientating ship for circularization burn&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>disengage</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>sas</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>sas_mode</span> <span class=o>=</span> <span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>sas_mode</span><span class=o>.</span><span class=n>maneuver</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Waiting until circularization burn&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>burn_ut</span> <span class=o>=</span> <span class=n>ut</span><span class=p>()</span> <span class=o>+</span> <span class=n>vessel</span><span class=o>.</span><span class=n>orbit</span><span class=o>.</span><span class=n>time_to_apoapsis</span> <span class=o>-</span> <span class=p>(</span><span class=n>burn_time</span><span class=o>/</span><span class=mf>2.</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>lead_time</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>space_center</span><span class=o>.</span><span class=n>warp_to</span><span class=p>(</span><span class=n>burn_ut</span> <span class=o>-</span> <span class=n>lead_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># Execute burn</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Ready to execute burn&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>time_to_apoapsis</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>add_stream</span><span class=p>(</span><span class=nb>getattr</span><span class=p>,</span> <span class=n>vessel</span><span class=o>.</span><span class=n>orbit</span><span class=p>,</span> <span class=s1>&#39;time_to_apoapsis&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>time_to_apoapsis</span><span class=p>()</span> <span class=o>-</span> <span class=p>(</span><span class=n>burn_time</span><span class=o>/</span><span class=mf>2.</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Executing burn&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>throttle</span> <span class=o>=</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>burn_time</span> <span class=o>-</span> <span class=mf>0.05</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Fine tuning&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>throttle</span> <span class=o>=</span> <span class=mf>0.05</span>
</span></span><span class=line><span class=cl><span class=n>remaining_burn</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>add_stream</span><span class=p>(</span><span class=n>node</span><span class=o>.</span><span class=n>remaining_burn_vector</span><span class=p>,</span> <span class=n>node</span><span class=o>.</span><span class=n>reference_frame</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#vessel.auto_pilot.engage()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>disengage</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>sas</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>.1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>sas_mode</span> <span class=o>=</span> <span class=n>vessel</span><span class=o>.</span><span class=n>auto_pilot</span><span class=o>.</span><span class=n>sas_mode</span><span class=o>.</span><span class=n>maneuver</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>throttle</span> <span class=o>=</span> <span class=mf>0.03</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>node</span><span class=o>.</span><span class=n>remaining_delta_v</span> <span class=o>&gt;</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>throttle</span> <span class=o>=</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl><span class=n>node</span><span class=o>.</span><span class=n>remove</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Launch complete&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>Orientating ship for circularization burn
Waiting until circularization burn
Ready to execute burn
Executing burn
Fine tuning
Launch complete
</code></pre><p>If all went well, you should be in a fairly accurate (and we can make it even better!) circularized orbit:</p><p><img src=/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-2e331.png width=786 height=525 srcset="/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-2e331_hu2218312690310119773.png 480w, /p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-2e331_hu13096795042021448279.png 1024w" loading=lazy alt="an orbital view of the rocket showing a circularized orbit" class=gallery-image data-flex-grow=149 data-flex-basis=359px></p><p>Now that we have circularized our orbit, we can do some house keeping and eject uneeded components from the rocket. In a future iteration, we will want to eject these as soon as we clear the atmosphere in order to reduce as much mass as soon as possible:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Drop stage 1</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>activate_next_stage</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># Drop the escape rocket</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>activate_next_stage</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># Drop the shields to lower weight</span>
</span></span><span class=line><span class=cl><span class=n>vessel</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>activate_next_stage</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-50aec.png width=515 height=346 srcset="/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-50aec_hu18435129135423642554.png 480w, /p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/assets/index-50aec_hu8836306924092878690.png 1024w" loading=lazy alt="showing the rocket against the milkyway with less stages" class=gallery-image data-flex-grow=148 data-flex-basis=357px></p></section><footer class=article-footer><section class=article-tags><a href=/tags/kerbal/>Kerbal</a>
<a href=/tags/python/>Python</a>
<a href=/tags/physics/>Physics</a>
<a href=/tags/space/>Space</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/python-uses-operational-chaining-for-boolean-comparisons/><div class=article-details><h2 class=article-title>Python Uses Operational Chaining for Boolean Comparisons</h2></div></a></article><article><a href=/p/bayesian-look-at-rapid-tests/><div class=article-details><h2 class=article-title>Bayesian look at rapid tests</h2></div></a></article><article><a href=/p/trappist-1-is-probably-not-alive/><div class=article-details><h2 class=article-title>TRAPPIST-1 is probably not alive</h2></div></a></article><article><a href=/p/devops-101-chef-cookbook-with-testing/><div class=article-details><h2 class=article-title>DevOps 101: Chef Cookbook with Testing</h2></div></a></article><article><a href=/p/abstracting-networking-with-docker-containers/><div class=article-details><h2 class=article-title>Abstracting Networking with Docker Containers</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024</section><section class=powerby>You are a wonderful manifestation of the evolution of the universe.<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> / Theme --> <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>