<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="A quick and dirty example of creating a chef cookbook with rspec tests."><title>DevOps 101: Chef Cookbook with Testing</title>
<link rel=canonical href=https://tdj28.github.io/p/devops-101-chef-cookbook-with-testing/><link rel=stylesheet href=/scss/style.min.a8973e64013f393b33658832ff110095f30eb03e142d9ad3540bb8edbbed8261.css><meta property='og:title' content="DevOps 101: Chef Cookbook with Testing"><meta property='og:description' content="A quick and dirty example of creating a chef cookbook with rspec tests."><meta property='og:url' content='https://tdj28.github.io/p/devops-101-chef-cookbook-with-testing/'><meta property='og:site_name' content><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='devops'><meta property='article:tag' content='sre'><meta property='article:published_time' content='2017-01-28T19:21:05-07:00'><meta property='article:modified_time' content='2017-01-28T19:21:05-07:00'><meta name=twitter:title content="DevOps 101: Chef Cookbook with Testing"><meta name=twitter:description content="A quick and dirty example of creating a chef cookbook with rspec tests."><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky compact"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu15237315471355360968.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>TJ</span></figure><div class=site-meta><h1 class=site-name><a href=/></a></h1><h2 class=site-description></h2></div></header><ol class=menu-social><li><a href=https://github.com/tdj28 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/tdj11100 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span></span></li></ol><ol class=menu id=main-menu></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon id=toc-toggle><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-notes"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 3m0 2a2 2 0 012-2h10a2 2 0 012 2v14a2 2 0 01-2 2H7a2 2 0 01-2-2z"/><path d="M9 7h6"/><path d="M9 11h6"/><path d="M9 15h4"/></svg></div><h2 class="widget-title section-title"></h2><div class=widget--toc id=toc-content><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a><ol><li><a href=#yet-another-chef-tutorial>Yet another chef tutorial</a><ol><li><a href=#getting-started>Getting started</a></li><li><a href=#create-the-core-configuration>Create the core configuration</a></li></ol></li><li><a href=#source-code>Source Code</a></li><li><a href=#future-steps>Future Steps</a></li></ol></li></ol></nav></div></section><script>document.getElementById("toc-toggle").addEventListener("click",function(){var e=document.getElementById("toc-content");e.style.display==="none"?e.style.display="block":e.style.display="none"})</script></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/deep-dive/>Deep-Dive
</a><a href=/categories/software/>Software</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/devops-101-chef-cookbook-with-testing/>DevOps 101: Chef Cookbook with Testing</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 28, 2017</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>13 minute read</time></div></footer></div></header><section class=article-content><h2 id=introduction>Introduction</h2><h3 id=yet-another-chef-tutorial>Yet another chef tutorial</h3><p>You can of course skip this step if you are familiar with Chef to a great enough degree, but in the spirit of making this a self-contained walkthrough, we will start from the ground up.</p><h4 id=getting-started>Getting started</h4><h5 id=installing-chefdk>Installing ChefDK</h5><p>It is widely considered best practice to use <a class=link href=https://downloads.chef.io/chefdk target=_blank rel=noopener>ChefDK</a>, and this walkthrough uses ChefDK exclusively.</p><ul><li>On Mac, install <a class=link href=http://brew.sh/ target=_blank rel=noopener>HomeBrew</a> and run <code>brew cask install chefdk</code></li><li>On Linux, <a class=link href=https://downloads.chef.io/chefdk target=_blank rel=noopener>download a package</a> corresponding to your distro and install accordingly.</li><li>On Windows: Run Linux as a Virtual Machine, get Docker for Windows, or <em>try</em> using Bash on Windows, but this walkthrough doesn&rsquo;t support Windows-based development.</li></ul><h5 id=initiating-your-cookbook>Initiating your cookbook</h5><p>Let&rsquo;s start with the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chef generate cookbook c9_ide_chef
</span></span></code></pre></td></tr></table></div></div><p>This command generates a template for a cookbook. Note that we use and underline in the name instead of a hyphen as hyphens can be problematic for chef in some circumstances. We now have a folder with the following content:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>├── .gitignore
</span></span><span class=line><span class=cl>├── .kitchen.yml
</span></span><span class=line><span class=cl>├── Berksfile
</span></span><span class=line><span class=cl>├── README.md
</span></span><span class=line><span class=cl>├── chefignore
</span></span><span class=line><span class=cl>├── metadata.rb
</span></span><span class=line><span class=cl>├── recipes
</span></span><span class=line><span class=cl>│   └── default.rb
</span></span><span class=line><span class=cl>├── spec
</span></span><span class=line><span class=cl>│   ├── spec_helper.rb
</span></span><span class=line><span class=cl>│   └── unit
</span></span><span class=line><span class=cl>│       └── recipes
</span></span><span class=line><span class=cl>│           └── default_spec.rb
</span></span><span class=line><span class=cl>└── <span class=nb>test</span>
</span></span><span class=line><span class=cl>    └── smoke
</span></span><span class=line><span class=cl>        └── default
</span></span><span class=line><span class=cl>            └── default_test.rb
</span></span></code></pre></td></tr></table></div></div><p>It also creates a <code>.delivery</code> and a <code>.git</code> folder whose contents are omitted here for clarity.</p><p>The second command creates an attribute folder which we can populate with default attributes for our cookbook, and the third line creates a default template for a &ldquo;message of the day&rdquo; to be displayed when first logging in.</p><p>The <code>.git</code> directory is useful and we will use it as the basis for a new repo in github repo.</p><h5 id=pushing-to-github>Pushing to GitHub</h5><p>Now that we have the skeleton for our cookbook, we should start pushing to GitHub for version-control. On GitHub, create a public repo called c9_ide. Then run the following commands:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git add .
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;First commit&#34;</span>
</span></span><span class=line><span class=cl>git remote add origin git@github.com:YOUR_GITHUB_USERNAME/c9_ide_chef.git
</span></span><span class=line><span class=cl>git push -u origin master
</span></span></code></pre></td></tr></table></div></div><p>Now the stage is set and we are ready to make the cookbook actually do something.</p><h4 id=create-the-core-configuration>Create the core configuration</h4><h5 id=creating-a-story-for-the-cookbook>Creating a story for the cookbook</h5><p>So far we&rsquo;ve seen how to set up the cookbook, but we don&rsquo;t quite know what we are going to do with it. Now is a good time to set up some goals for our cookbook:</p><ul><li>It should update all packages before doing anything else</li><li>It should create a message of the day that gives basic information about the server to a user logging in</li><li>It should install basic security packages and other utilities</li><li>It should install the packages needed to run Cloud 9 IDE</li><li>It should pull and install Cloud 9 IDE</li></ul><h6 id=updating-all-packages>Updating all packages</h6><p>Just for fun, we are going to make our cookbook work for both Debian and RHEL variations of Linux. Under the recipes folder, let&rsquo;s create a recipe file called <code>update.rb</code> and give it contents:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=c1># Update system to start with</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=n>node</span><span class=o>[</span><span class=s1>&#39;platform&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>when</span> <span class=s1>&#39;debian&#39;</span><span class=p>,</span> <span class=s1>&#39;ubuntu&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>execute</span> <span class=s1>&#39;AptUpdateUpgrade&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=n>command</span> <span class=s2>&#34;apt-get update &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get upgrade -y&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>when</span> <span class=s1>&#39;redhat&#39;</span><span class=p>,</span> <span class=s1>&#39;centos&#39;</span><span class=p>,</span> <span class=s1>&#39;fedora&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     <span class=c1># Update all packages</span>
</span></span><span class=line><span class=cl>    <span class=n>execute</span> <span class=s1>&#39;UpdateYum&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=n>command</span> <span class=s2>&#34;yum -y update&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Add Fedora&#39;s Extra Packages for Enterprise Linux</span>
</span></span><span class=line><span class=cl>    <span class=n>execute</span> <span class=s1>&#39;GetEPELRepo&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=n>command</span> <span class=s2>&#34;rpm -iUvh http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-9.noarch.rpm&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>not_if</span> <span class=s2>&#34;rpm -qa | grep -qx &#39;epel-release-7-9.noarch&#39;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>in the <code>default.rb</code> recipe, add the line:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>include_recipe</span> <span class=s1>&#39;c9_ide::update&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>That&rsquo;s it for now! Before we go any further, let&rsquo;s test this. Chef has automatically added some basis for testing to your repo. Let&rsquo;s start with kitchen. This assumes you have <a class=link href=https://www.virtualbox.org/wiki/Downloads target=_blank rel=noopener>VirtualBox</a> and <a class=link href=https://www.vagrantup.com/ target=_blank rel=noopener>Vagrant</a> installed (if you don&rsquo;t, install them). At the base directory, run:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kitchen create
</span></span><span class=line><span class=cl>kitchen converge
</span></span></code></pre></td></tr></table></div></div><p>The first command creates the virtual machines for us to work with, and teh second command cooks Chef inside of them. It is a very convenient way to do a full test of your code before pushing to github. The converge command may take quite a while as we are updating all packages on the systems and doing it for two VMs, and Ubuntu one and a CentOS one. If all goes well, the final output looks like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Chef Client finished, 1/1 resources updated in <span class=m>02</span> minutes <span class=m>21</span> seconds
</span></span></code></pre></td></tr></table></div></div><h6 id=creating-a-c9-user>Creating a C9 User</h6><p>It is rarely a good idea to run a program as root. As such, our next step is to create a user for running the Cloud 9 IDE. We start by creating a data bag. First, install knife-solo and <a class=link href=https://github.com/thbishop/knife-solo_data_bag target=_blank rel=noopener>knife-solo data bag</a>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chef gem install knife-solo
</span></span><span class=line><span class=cl>chef gem install knife-solo_data_bag
</span></span></code></pre></td></tr></table></div></div><p>This is not entirely necessary, but that tool can be useful in other ways for making chef solo cookbooks. Then we can generate a databag and databag item:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir data_bags
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>EDITOR</span><span class=o>=</span><span class=s2>&#34;vi&#34;</span>
</span></span><span class=line><span class=cl>knife solo data bag create users c9ide
</span></span></code></pre></td></tr></table></div></div><p>In the editor that pops up, paste the following content:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;c9ide&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;comment&#34;</span><span class=p>:</span> <span class=s2>&#34;c9ide User&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ssh_keys&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;home&#34;</span><span class=p>:</span> <span class=s2>&#34;/home/c9ide&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ssh_keygen&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Next, back to <code>recipe/default.rb</code>, we can invoke the external chef recipe &ldquo;users&rdquo; to have this user installed on our system:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>include_recipe</span> <span class=s1>&#39;user::data_bag&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>To create an attributes file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chef generate attribute default
</span></span></code></pre></td></tr></table></div></div><p>and in <code>attributes/default.rb</code> add the line:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>default</span><span class=o>[</span><span class=s1>&#39;users&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=s1>&#39;c9ide&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>This of course shows the fantastic power and utility of Chef since we can call upon a wide range of libraries already created by the chef community. Now we need to tell Chef that we are using an external library, so in our <code>metadata.rb</code> file at the top level we add the line at the end:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>depends</span>          <span class=s1>&#39;user&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>At the same level there is a Berksfile with the content:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>source</span> <span class=s1>&#39;https://supermarket.chef.io&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>metadata</span>
</span></span></code></pre></td></tr></table></div></div><p>which tells chef to check this <code>metadata.rb</code> file for dependencies (such as the user dependency we just added) that we need to pull and make available during cooking. We&rsquo;ll show how this is done manually a bit later, but for now <code>kitchen converge</code> takes care of that.</p><p>Now run <code>kitchen converge</code> one more time, and you should see that the user is created.</p><p>Let&rsquo;s create a quick smoke test item, add:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>describe</span> <span class=n>user</span><span class=p>(</span><span class=s1>&#39;c9ide&#39;</span><span class=p>)</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=n>it</span> <span class=p>{</span> <span class=n>should</span> <span class=n>exist</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>to <code>test/default/default_test.rb</code> and run</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kitchen verify
</span></span></code></pre></td></tr></table></div></div><p>if all went well you will see:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> User c9ide
</span></span><span class=line><span class=cl>     ✔  should exist
</span></span></code></pre></td></tr></table></div></div><p>Now is a good time to push to github:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git add .
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;Adds update and users&#34;</span>
</span></span><span class=line><span class=cl>git push origin master
</span></span></code></pre></td></tr></table></div></div><h6 id=installing-motd>Installing MOTD</h6><p>First, let&rsquo;s generate a blank template file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chef generate template motd
</span></span></code></pre></td></tr></table></div></div><p>fill with content:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&lt;%<span class=o>=</span> node<span class=o>[</span><span class=s1>&#39;motd-attributes&#39;</span><span class=o>][</span><span class=s1>&#39;message&#39;</span><span class=o>]</span> %&gt;
</span></span><span class=line><span class=cl>The hostname of this node is &lt;%<span class=o>=</span> node<span class=o>[</span><span class=s1>&#39;hostname&#39;</span><span class=o>]</span> %&gt;
</span></span><span class=line><span class=cl>The IP address of this node is &lt;%<span class=o>=</span> node<span class=o>[</span><span class=s1>&#39;ipaddress&#39;</span><span class=o>]</span> %&gt;
</span></span></code></pre></td></tr></table></div></div><p>and create a recipe file <code>recipes/motd.rb</code> with contents:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>template <span class=s1>&#39;/etc/motd&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>      <span class=nb>source</span> <span class=s1>&#39;motd.erb&#39;</span>
</span></span><span class=line><span class=cl>      mode <span class=s1>&#39;0644&#39;</span>
</span></span><span class=line><span class=cl>end
</span></span></code></pre></td></tr></table></div></div><p>and finally add this line to the <code>attributes/default.rb</code> file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>default</span><span class=o>[</span><span class=s1>&#39;motd-attributes&#39;</span><span class=o>][</span><span class=s1>&#39;message&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=s2>&#34;A Cloud 9 IDE server&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>We add the following tests at <code>test/smoke/default/motd_test.rb</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>describe</span> <span class=n>directory</span><span class=p>(</span><span class=s1>&#39;/etc/motd&#39;</span><span class=p>)</span> <span class=k>do</span>  <span class=c1># describe this directory</span>
</span></span><span class=line><span class=cl>	<span class=n>its</span><span class=p>(</span><span class=ss>:content</span><span class=p>)</span> <span class=p>{</span> <span class=n>should</span> <span class=n>match</span> <span class=sr>/A Cloud 9 IDE server/</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>We run <code>kitchen converge</code> and <code>kitchen verify</code> again to make sure the recipe is fine, and then push to github as before.</p><h6 id=installing-packages>Installing Packages</h6><p>We are getting close to installing the Cloud9 IDE. Before doing so, we need to install some packages. Some of these packages are for security purposes, or convenience in administration, while others are needed for the Cloud 9 IDE system.</p><p>Create a file <code>recipe/packages.rb</code> with content:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>case</span> <span class=n>node</span><span class=o>[</span><span class=s1>&#39;platform&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=k>when</span> <span class=s1>&#39;debian&#39;</span><span class=p>,</span> <span class=s1>&#39;ubuntu&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>req_packages</span> <span class=o>=</span> <span class=o>[</span><span class=s1>&#39;fail2ban&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;gcc&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;g++&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;git&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;htop&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;make&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;nodejs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;nmap&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;npm&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;sysstat&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;unattended-upgrades&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;apt-listchanges&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>req_packages</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>packs</span><span class=o>|</span>
</span></span><span class=line><span class=cl>      <span class=no>Chef</span><span class=o>::</span><span class=no>Log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Installing: &#34;</span> <span class=o>+</span> <span class=n>packs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>package</span> <span class=n>packs</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=n>action</span> <span class=ss>:install</span>
</span></span><span class=line><span class=cl>      <span class=k>end</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>template</span> <span class=s1>&#39;/etc/apt/apt.conf.d/50unattended-upgrades&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=n>owner</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>group</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>mode</span> <span class=s1>&#39;0644&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>source</span> <span class=s1>&#39;50unattended-upgrades.erb&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>template</span> <span class=s1>&#39;/etc/apt/apt.conf.d/20auto-upgrades&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=n>owner</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>group</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>mode</span> <span class=s1>&#39;0644&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>source</span> <span class=s1>&#39;20auto-upgrades.erb&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>when</span> <span class=s1>&#39;redhat&#39;</span><span class=p>,</span> <span class=s1>&#39;centos&#39;</span><span class=p>,</span> <span class=s1>&#39;fedora&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>req_packages</span> <span class=o>=</span> <span class=o>[</span><span class=s1>&#39;fail2ban&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;gcc-c++&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;git&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;glibc-static&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;htop&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;make&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;nodejs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;nmap&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;npm&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;sysstat&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;yum-cron&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>req_packages</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>packs</span><span class=o>|</span>
</span></span><span class=line><span class=cl>      <span class=no>Chef</span><span class=o>::</span><span class=no>Log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Installing: &#34;</span> <span class=o>+</span> <span class=n>packs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=n>package</span> <span class=n>packs</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=n>action</span> <span class=ss>:install</span>
</span></span><span class=line><span class=cl>      <span class=k>end</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>template</span> <span class=s1>&#39;/etc/yum/yum-cron.conf&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>        <span class=n>owner</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>group</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>mode</span> <span class=s1>&#39;0644&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>source</span> <span class=s1>&#39;yum-cron.conf.erb&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>execute</span> <span class=s1>&#39;systemctl enable yum-cron&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>execute</span> <span class=s1>&#39;systemctl start yum-cron&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>Notice that we have sneaked in automated security updates as well. For that, we require the following templates:</p><p><code>templates/50unattended-upgrades.erb</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>// Automatically upgrade packages from these <span class=o>(</span>origin, archive<span class=o>)</span> pairs
</span></span><span class=line><span class=cl>Unattended-Upgrade::Allowed-Origins <span class=o>{</span>
</span></span><span class=line><span class=cl>  &lt;% node<span class=o>[</span><span class=s1>&#39;unattended-upgrades&#39;</span><span class=o>][</span><span class=s1>&#39;origins&#39;</span><span class=o>]</span>.each <span class=k>do</span> <span class=p>|</span>origin<span class=p>|</span> %&gt;
</span></span><span class=line><span class=cl>  <span class=s2>&#34;&lt;%= origin %&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  &lt;% end %&gt;
</span></span><span class=line><span class=cl><span class=o>}</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// List of packages to not update
</span></span><span class=line><span class=cl>Unattended-Upgrade::Package-Blacklist <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;apache2&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;nginx&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>//  <span class=s2>&#34;libc6-dev&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>//  <span class=s2>&#34;libc6-i686&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Send email to this address <span class=k>for</span> problems or packages upgrades
</span></span><span class=line><span class=cl>// If empty or <span class=nb>unset</span> <span class=k>then</span> no email is sent, make sure that you
</span></span><span class=line><span class=cl>// have a working mail setup on your system. The package <span class=s1>&#39;mailx&#39;</span>
</span></span><span class=line><span class=cl>// must be installed or anything that provides /usr/bin/mail.
</span></span><span class=line><span class=cl>&lt;%<span class=o>=</span> node<span class=o>[</span><span class=s1>&#39;unattended-upgrades&#39;</span><span class=o>][</span><span class=s1>&#39;send_email&#39;</span><span class=o>]</span> ? <span class=s2>&#34;&#34;</span> : <span class=s2>&#34;// &#34;</span> %&gt;Unattended-Upgrade::Mail <span class=s2>&#34;&lt;%= node[&#39;unattended-upgrades&#39;][&#39;email_address&#39;] %&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Do automatic removal of new unused dependencies after the upgrade
</span></span><span class=line><span class=cl>// <span class=o>(</span>equivalent to apt-get autoremove<span class=o>)</span>
</span></span><span class=line><span class=cl>Unattended-Upgrade::Remove-Unused-Dependencies <span class=s2>&#34;&lt;%= node[&#39;unattended-upgrades&#39;][&#39;auto_remove&#39;] ? &#34;</span>true<span class=s2>&#34; : &#34;</span>false<span class=s2>&#34; %&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Automatically reboot *WITHOUT CONFIRMATION* <span class=k>if</span> a
</span></span><span class=line><span class=cl>// the file /var/run/reboot-required is found after the upgrade
</span></span><span class=line><span class=cl>Unattended-Upgrade::Automatic-Reboot <span class=s2>&#34;&lt;%= node[&#39;unattended-upgrades&#39;][&#39;auto_reboot&#39;] ? &#34;</span>true<span class=s2>&#34; : &#34;</span>false<span class=s2>&#34; %&gt;&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>templates/20auto-upgrades.erb</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>APT::Periodic::Update-Package-Lists <span class=s2>&#34;&lt;%=node[&#39;unattended-upgrades&#39;][&#39;update_package_lists_interval&#39;]%&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>APT::Periodic::Unattended-Upgrade <span class=s2>&#34;&lt;%=node[&#39;unattended-upgrades&#39;][&#39;upgrade_interval&#39;]%&gt;&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>and</p><p><code>templates/yum-cron.conf.erb</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>update_cmd</span> <span class=o>=</span> security
</span></span><span class=line><span class=cl><span class=nv>apply_updates</span> <span class=o>=</span> yes
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>default<span class=o>[</span><span class=s1>&#39;unattended-upgrades&#39;</span><span class=o>][</span><span class=s1>&#39;update_package_lists_interval&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>default<span class=o>[</span><span class=s1>&#39;unattended-upgrades&#39;</span><span class=o>][</span><span class=s1>&#39;upgrade_interval&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>default<span class=o>[</span><span class=s1>&#39;unattended-upgrades&#39;</span><span class=o>][</span><span class=s1>&#39;origins&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=o>[</span><span class=s1>&#39;${distro_id} ${distro_codename}-security&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>default<span class=o>[</span><span class=s1>&#39;unattended-upgrades&#39;</span><span class=o>][</span><span class=s1>&#39;send_email&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=nb>false</span>
</span></span><span class=line><span class=cl>default<span class=o>[</span><span class=s1>&#39;unattended-upgrades&#39;</span><span class=o>][</span><span class=s1>&#39;email_address&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=s2>&#34;test@example.com&#34;</span>
</span></span><span class=line><span class=cl>default<span class=o>[</span><span class=s1>&#39;unattended-upgrades&#39;</span><span class=o>][</span><span class=s1>&#39;auto_remove&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=nb>false</span>
</span></span><span class=line><span class=cl>default<span class=o>[</span><span class=s1>&#39;unattended-upgrades&#39;</span><span class=o>][</span><span class=s1>&#39;auto_reboot&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=nb>false</span>
</span></span></code></pre></td></tr></table></div></div><p>and of course, our inspec test in <code>test/smoke/default/packages_test.rb</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>if</span> <span class=n>os</span><span class=o>[</span><span class=ss>:family</span><span class=o>]</span> <span class=o>==</span> <span class=s1>&#39;debian&#39;</span>
</span></span><span class=line><span class=cl>  	<span class=n>req_packages</span> <span class=o>=</span> <span class=o>[</span><span class=s1>&#39;fail2ban&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;gcc&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;g++&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;git&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;htop&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;make&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;nodejs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;nmap&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;npm&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;sysstat&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;unattended-upgrades&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;apt-listchanges&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>req_packages</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>packs</span><span class=o>|</span>
</span></span><span class=line><span class=cl>      <span class=n>describe</span> <span class=n>package</span><span class=p>(</span><span class=n>packs</span><span class=p>)</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>      	<span class=n>it</span> <span class=p>{</span> <span class=n>should</span> <span class=n>be_installed</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>end</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>req_packages</span> <span class=o>=</span> <span class=o>[</span><span class=s1>&#39;fail2ban&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;gcc-c++&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;git&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;glibc-static&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;htop&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;make&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;nodejs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;nmap&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;npm&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;sysstat&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;yum-cron&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>req_packages</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>packs</span><span class=o>|</span>
</span></span><span class=line><span class=cl>      <span class=n>describe</span> <span class=n>package</span><span class=p>(</span><span class=n>packs</span><span class=p>)</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>      	<span class=n>it</span> <span class=p>{</span> <span class=n>should</span> <span class=n>be_installed</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>end</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=installing-cloud-9-ide>Installing Cloud 9 IDE</h6><p>Chef has a built-in git resource that we can use to pull the Cloud 9 IDE code.</p><p>The test for this section will be rather brief:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>describe</span> <span class=n>directory</span><span class=p>(</span><span class=s1>&#39;/home/c9ide/core/README.md&#39;</span><span class=p>)</span> <span class=k>do</span>  <span class=c1># describe this directory</span>
</span></span><span class=line><span class=cl>	<span class=n>its</span><span class=p>(</span><span class=ss>:content</span><span class=p>)</span> <span class=p>{</span> <span class=n>should</span> <span class=n>match</span> <span class=sr>/^Cloud9/</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>and the reason is that we can really verify whether or not this section succeeded in the next section on running via supervisor.</p><p>The code for this section, in <code>/recipes/c9ide.rb</code>, is:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>git</span> <span class=s2>&#34;/home/c9ide/core&#34;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>   <span class=n>repository</span> <span class=s1>&#39;https://github.com/c9/core.git&#39;</span>
</span></span><span class=line><span class=cl>   <span class=n>reference</span> <span class=s1>&#39;master&#39;</span>
</span></span><span class=line><span class=cl>   <span class=n>action</span> <span class=ss>:sync</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=n>node</span><span class=o>[</span><span class=s1>&#39;platform&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=k>when</span> <span class=s1>&#39;debian&#39;</span><span class=p>,</span> <span class=s1>&#39;ubuntu&#39;</span>
</span></span><span class=line><span class=cl>	<span class=n>bash</span> <span class=s1>&#39;create nodejs link&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>		<span class=n>code</span> <span class=s>&lt;&lt;-EOH
</span></span></span><span class=line><span class=cl><span class=s></span>		<span class=n>ln</span> <span class=o>-</span><span class=n>s</span> <span class=sr>/usr/</span><span class=n>bin</span><span class=o>/</span><span class=n>nodejs</span> <span class=sr>/usr/</span><span class=n>bin</span><span class=o>/</span><span class=n>node</span>
</span></span><span class=line><span class=cl>		<span class=no>EOH</span>
</span></span><span class=line><span class=cl>		<span class=n>not_if</span> <span class=p>{</span> <span class=o>::</span><span class=no>File</span><span class=o>.</span><span class=n>exist?</span><span class=p>(</span><span class=s1>&#39;/usr/bin/node&#39;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bash</span> <span class=s1>&#39;install_cloud9ide&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>   <span class=n>cwd</span> <span class=s1>&#39;/home/c9ide/core/&#39;</span>
</span></span><span class=line><span class=cl>   <span class=n>user</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl>   <span class=n>code</span> <span class=s>&lt;&lt;-EOH
</span></span></span><span class=line><span class=cl><span class=s></span>     <span class=n>scripts</span><span class=o>/</span><span class=n>install</span><span class=o>-</span><span class=n>sdk</span><span class=o>.</span><span class=n>sh</span>
</span></span><span class=line><span class=cl>     <span class=no>EOH</span>
</span></span><span class=line><span class=cl>   <span class=n>environment</span> <span class=s1>&#39;PREFIX&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;/usr/local&#39;</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><h6 id=installing-supervisor>Installing Supervisor</h6><p>Finally, we want to leave our server running Cloud 9 IDE after provisioning it. Supervisor is a fantastic way to do so, though of course not the only way and perhaps not even the best way, but it is a convenient and production-ready solution (though this development kit version of Cloud 9 IDE is not production material and is meant for development purposes).</p><p>In <code>recipes/supervisor.rb</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>package</span> <span class=s1>&#39;supervisor&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span> <span class=ss>:install</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=n>node</span><span class=o>[</span><span class=s1>&#39;platform&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=k>when</span> <span class=s1>&#39;debian&#39;</span><span class=p>,</span> <span class=s1>&#39;ubuntu&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>cookbook_file</span> <span class=s1>&#39;/etc/supervisor/conf.d/cloud9ide.conf&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>	  <span class=n>source</span> <span class=s1>&#39;c9ide.conf&#39;</span>
</span></span><span class=line><span class=cl>	  <span class=n>owner</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl>	  <span class=n>group</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl>	  <span class=n>mode</span> <span class=s1>&#39;0755&#39;</span>
</span></span><span class=line><span class=cl>	  <span class=n>action</span> <span class=ss>:create</span>
</span></span><span class=line><span class=cl>	<span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>execute</span> <span class=s1>&#39;start supervisor&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>	  <span class=n>command</span> <span class=s1>&#39;service supervisor start&#39;</span>
</span></span><span class=line><span class=cl>	<span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>execute</span> <span class=s1>&#39;reload supervisor&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>	  <span class=n>command</span> <span class=s1>&#39;supervisorctl update&#39;</span>
</span></span><span class=line><span class=cl>	<span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>when</span> <span class=s1>&#39;redhat&#39;</span><span class=p>,</span> <span class=s1>&#39;centos&#39;</span><span class=p>,</span> <span class=s1>&#39;fedora&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>cookbook_file</span> <span class=s1>&#39;/etc/supervisord.d/cloud9ide.ini&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>	  <span class=n>source</span> <span class=s1>&#39;c9ide.conf&#39;</span>
</span></span><span class=line><span class=cl>	  <span class=n>owner</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl>	  <span class=n>group</span> <span class=s1>&#39;root&#39;</span>
</span></span><span class=line><span class=cl>	  <span class=n>mode</span> <span class=s1>&#39;0755&#39;</span>
</span></span><span class=line><span class=cl>	  <span class=n>action</span> <span class=ss>:create</span>
</span></span><span class=line><span class=cl>	<span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>execute</span> <span class=s1>&#39;start supervisor&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>	  <span class=n>command</span> <span class=s1>&#39;service supervisord start&#39;</span>
</span></span><span class=line><span class=cl>	<span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>execute</span> <span class=s1>&#39;reload supervisor&#39;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>	  <span class=n>command</span> <span class=s1>&#39;supervisorctl update&#39;</span>
</span></span><span class=line><span class=cl>	<span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>and finally add this to the <code>c9ide_test.rb</code> test file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>describe</span> <span class=n>port</span><span class=p>(</span><span class=mi>9999</span><span class=p>)</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=n>it</span> <span class=p>{</span> <span class=n>should</span> <span class=n>be_listening</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><h5 id=putting-it-all-together>Putting it all together</h5><p>The default recipe should now look like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>include_recipe</span> <span class=s1>&#39;c9_ide::update&#39;</span>
</span></span><span class=line><span class=cl><span class=n>include_recipe</span> <span class=s1>&#39;user::data_bag&#39;</span>
</span></span><span class=line><span class=cl><span class=n>include_recipe</span> <span class=s1>&#39;c9_ide::motd&#39;</span>
</span></span><span class=line><span class=cl><span class=n>include_recipe</span> <span class=s1>&#39;c9_ide::packages&#39;</span>
</span></span><span class=line><span class=cl><span class=n>include_recipe</span> <span class=s1>&#39;c9_ide::cloud9ide&#39;</span>
</span></span><span class=line><span class=cl><span class=n>include_recipe</span> <span class=s1>&#39;c9_ide::supervisor&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>we run a final <code>kitchen converge</code>; if all goes well, we follow up with a final <code>kitchen verify</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>-----&gt; Starting Kitchen <span class=o>(</span>v1.14.2<span class=o>)</span>
</span></span><span class=line><span class=cl>-----&gt; Setting up &lt;default-ubuntu-1604&gt;...
</span></span><span class=line><span class=cl>       Finished setting up &lt;default-ubuntu-1604&gt; <span class=o>(</span>0m0.00s<span class=o>)</span>.
</span></span><span class=line><span class=cl>-----&gt; Verifying &lt;default-ubuntu-1604&gt;...
</span></span><span class=line><span class=cl>       Loaded
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Target:  ssh://vagrant@127.0.0.1:2222
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  File /home/c9ide/core/README.md
</span></span><span class=line><span class=cl>     ✔  content should match /^Cloud9/
</span></span><span class=line><span class=cl>  Port <span class=m>9999</span>
</span></span><span class=line><span class=cl>     ✔  should be listening
</span></span><span class=line><span class=cl>  User c9ide
</span></span><span class=line><span class=cl>     ✔  should exist
</span></span><span class=line><span class=cl>  File /etc/motd
</span></span><span class=line><span class=cl>     ✔  content should match /A Cloud <span class=m>9</span> IDE server/
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  fail2ban should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  gcc should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  g++ should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  git should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  htop should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  make should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  nodejs should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  nmap should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  npm should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  sysstat should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  unattended-upgrades should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  apt-listchanges should be installed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Test Summary: <span class=m>16</span> successful, <span class=m>0</span> failures, <span class=m>0</span> skipped
</span></span><span class=line><span class=cl>       Finished verifying &lt;default-ubuntu-1604&gt; <span class=o>(</span>0m1.28s<span class=o>)</span>.
</span></span><span class=line><span class=cl>-----&gt; Setting up &lt;default-centos-72&gt;...
</span></span><span class=line><span class=cl>       Finished setting up &lt;default-centos-72&gt; <span class=o>(</span>0m0.00s<span class=o>)</span>.
</span></span><span class=line><span class=cl>-----&gt; Verifying &lt;default-centos-72&gt;...
</span></span><span class=line><span class=cl>       Loaded
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Target:  ssh://vagrant@127.0.0.1:2200
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  File /home/c9ide/core/README.md
</span></span><span class=line><span class=cl>     ✔  content should match /^Cloud9/
</span></span><span class=line><span class=cl>  Port <span class=m>9999</span>
</span></span><span class=line><span class=cl>     ✔  should be listening
</span></span><span class=line><span class=cl>  User c9ide
</span></span><span class=line><span class=cl>     ✔  should exist
</span></span><span class=line><span class=cl>  File /etc/motd
</span></span><span class=line><span class=cl>     ✔  content should match /A Cloud <span class=m>9</span> IDE server/
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  fail2ban should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  gcc-c++ should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  git should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  glibc-static should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  htop should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  make should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  nodejs should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  nmap should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  npm should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  sysstat should be installed
</span></span><span class=line><span class=cl>  System Package
</span></span><span class=line><span class=cl>     ✔  yum-cron should be installed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Test Summary: <span class=m>15</span> successful, <span class=m>0</span> failures, <span class=m>0</span> skipped
</span></span><span class=line><span class=cl>       Finished verifying &lt;default-centos-72&gt; <span class=o>(</span>0m13.80s<span class=o>)</span>.
</span></span><span class=line><span class=cl>-----&gt; Kitchen is finished. <span class=o>(</span>0m16.47s<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Congratulations, you have a basic working chef recipe for installing Cloud 9 IDE, tested and provisioned on both major families of Linux.</p><h3 id=source-code>Source Code</h3><p>You can find the source code for this recipe on my github account <a class=link href=https://github.com/3implieschaos/c9_ide_chef/tree/PartI target=_blank rel=noopener>here</a>.</p><h3 id=future-steps>Future Steps</h3><p>We took some shortcuts and avoided some best practices for convenience here. Ideally we would like some unit tests and to pull in more community recipes. For example, the supervisor chef cookbook could be used here instead of dealing with that in a platform case.</p><p>In the forthcoming Part II, we will use Puppet, a widely used alternative to Chef, to provision a server that runs the Cloud 9 IDE SDK as we have here with Chef.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/devops/>Devops</a>
<a href=/tags/sre/>Sre</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/abstracting-networking-with-docker-containers/><div class=article-details><h2 class=article-title>Abstracting Networking with Docker Containers</h2></div></a></article><article><a href=/p/python-uses-operational-chaining-for-boolean-comparisons/><div class=article-details><h2 class=article-title>Python Uses Operational Chaining for Boolean Comparisons</h2></div></a></article><article><a href=/p/bayesian-look-at-rapid-tests/><div class=article-details><h2 class=article-title>Bayesian look at rapid tests</h2></div></a></article><article><a href=/p/automating-the-circularization-of-apollo-in-kerbal-with-python-krpc-and-physics/><div class=article-details><h2 class=article-title>Automating the circularization of Apollo in Kerbal with python, KRPC, and Physics</h2></div></a></article><article><a href=/p/a-risk-analysis-bowtie-diagram-in-latex/><div class=article-details><h2 class=article-title>A Risk Analysis Bowtie Diagram in Latex</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024</section><section class=powerby>You are a wonderful manifestation of the evolution of the universe.<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> / Theme --> <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>